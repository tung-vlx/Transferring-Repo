Public Function StockBizShareholder(stockCode)
    Dim ie As New InternetExplorer
    Dim doc As New HTMLDocument
    Dim pageData As Object
    Dim shData As String
    
    On Error GoTo ErrorHandler
    
    ie.Visible = True
    ie.navigate "http://en.stockbiz.vn/Stocks/" + stockCode + "/MajorHolders.aspx"
    Do
        DoEvents
    Loop Until ie.readyState = READYSTATE_COMPLETE
    
    Set doc = ie.document
    Set pageData = doc.querySelectorAll("table.ctl00_PlaceHolderContentArea_CenterZone_1 td.NoPadding div table tr.rowcolor2")(0)
    
    StockBizShareholder = Left(pageData.Children.Item(0).innerText, Len(pageData.Children.Item(0).innerText) - 1) + " - " + Left(pageData.Children.Item(3).innerText, Len(pageData.Children.Item(3).innerText) - 1)
    
    ie.Quit
    
ErrorHandler:
    ie.Quit
    Exit Function
    
End Function

Public Function StockBizVNeseName(stock_code)
    Dim objRequest As Object
    Dim strURL As String
    Dim token_1 As String
    Dim token_2 As String
    Dim json As Object
    Dim blnAsync As Boolean
    Dim strResponse As String
    
    token_1 = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm"
    token_1 = token_1 & "4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxOTcwNDY4OTYwLCJuYmYiOjE2NzA0Njg5NjAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiJjY2Q0OTZkZi0xZGJiLTRlOGQtODIxNC03NmVhMzJkMDI0YzkiLCJhdXRoX3RpbWUiOjE2NzA0Njg5NjAsImlkcCI6Imlkc3J2IiwibmFtZSI6ImJpdmFiaW4xMDBAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlZTJkZWY5NC03MGExLTQxODktYjlmZS01N2QyMmM3Mjk4NTkiLCJqdGkiOiJlYzEwNzUwNzZjMGEzNjg"
    
    token_2 = "wZDZjY2ExMDc2MWUyOWMyNCIsImFtciI6WyJwYXNzd29yZCJdfQ.VQYlpwEn8Qx6f9CiUVX7d6YP7x6QpfBrOs3td1bjicS1mpIneOO95yxRjDmYFdSFHNG1SpJwof0cvu6bfiuCcl08HPaQscOqv0497y-Z5L8qk9T4EDJfRtMauBTSiR8k1sv21W6-7qZvjTrgGdDWhGojYNadZs0hXnmV0wv-Kx9_bEkUhzt9O78QI9Y1Vb6pjBKhKMk0jQqlLmI_CqLlZ0JJk8Hgr9vcUX91JL5oIieyKcRfZ2gbcSfLpAxSxeEpkU4HWJ-C5B1rqokDjfAJ9fTHM_yRY6zmCz6PljEf0Xoc865br3lRWKSXhjSu127hIQlDmH_rVoZU9JdnekHsLA"
    
    Set objRequest = CreateObject("MSXML2.XMLHTTP")
    strURL = "https://api.fireant.vn/symbols/" & stock_code & "/profile"
    blnAsync = True
    
    With objRequest
        .Open "GET", strURL, blnAsync
        .SetRequestHeader "Content-Type", "application/json"
        .SetRequestHeader "Authorization", token_1 & token_2
        .Send
        
        While objRequest.readyState <> 4
            DoEvents
        Wend
        
        strResponse = .ResponseText
        
    End With
    
    Set json = JsonConverter.ParseJson(strResponse)
    StockBizVNeseName = json("companyName")
End Function

Function StockBizEnglishName(stockCode)
    Dim ie As New InternetExplorer
    Dim doc As New HTMLDocument
    Dim pageData As Object
    Dim data As String
    
    On Error GoTo ErrorHandler
    
    ie.Visible = True
    ie.navigate "http://en.stockbiz.vn/Stocks/" + stockCode + "/MajorHolders.aspx"
    Do
        DoEvents
    Loop Until ie.readyState = READYSTATE_COMPLETE
    
    Set doc = ie.document
    Set pageData = doc.querySelector("table.ctl00_PlaceHolderContentArea_CenterZone_1 td.NoPadding div.CompanyTitle")
    
    StockBizEnglishName = Left(pageData.innerText, InStr(1, pageData.innerText, " (" & stockCode) - 1)
    
    ie.Quit
    
ErrorHandler:
    ie.Quit
    Exit Function
    
End Function

Public Function StockBizWeb(stock_code)
    Dim objRequest As Object
    Dim strURL As String
    Dim token_1 As String
    Dim token_2 As String
    Dim json As Object
    Dim blnAsync As Boolean
    Dim strResponse As String
    Dim webAdress As String
    
    On Error GoTo ErrorHandler
    
    token_1 = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm"
    token_1 = token_1 & "4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxOTcwNDY4OTYwLCJuYmYiOjE2NzA0Njg5NjAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiJjY2Q0OTZkZi0xZGJiLTRlOGQtODIxNC03NmVhMzJkMDI0YzkiLCJhdXRoX3RpbWUiOjE2NzA0Njg5NjAsImlkcCI6Imlkc3J2IiwibmFtZSI6ImJpdmFiaW4xMDBAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlZTJkZWY5NC03MGExLTQxODktYjlmZS01N2QyMmM3Mjk4NTkiLCJqdGkiOiJlYzEwNzUwNzZjMGEzNjg"
    
    token_2 = "wZDZjY2ExMDc2MWUyOWMyNCIsImFtciI6WyJwYXNzd29yZCJdfQ.VQYlpwEn8Qx6f9CiUVX7d6YP7x6QpfBrOs3td1bjicS1mpIneOO95yxRjDmYFdSFHNG1SpJwof0cvu6bfiuCcl08HPaQscOqv0497y-Z5L8qk9T4EDJfRtMauBTSiR8k1sv21W6-7qZvjTrgGdDWhGojYNadZs0hXnmV0wv-Kx9_bEkUhzt9O78QI9Y1Vb6pjBKhKMk0jQqlLmI_CqLlZ0JJk8Hgr9vcUX91JL5oIieyKcRfZ2gbcSfLpAxSxeEpkU4HWJ-C5B1rqokDjfAJ9fTHM_yRY6zmCz6PljEf0Xoc865br3lRWKSXhjSu127hIQlDmH_rVoZU9JdnekHsLA"
    
    Set objRequest = CreateObject("MSXML2.XMLHTTP")
    strURL = "https://api.fireant.vn/symbols/" & stock_code & "/profile"
    blnAsync = True
    
    With objRequest
        .Open "GET", strURL, blnAsync
        .SetRequestHeader "Content-Type", "application/json"
        .SetRequestHeader "Authorization", token_1 & token_2
        .Send
        
        While objRequest.readyState <> 4
            DoEvents
        Wend
        
        strResponse = .ResponseText
        
    End With
    
    Set json = JsonConverter.ParseJson(strResponse)
    webAdress = json("webAddress")
    webAdress = Replace(webAdress, " ", vbNullString)
    
    If Left(json("webAddress"), 4) <> "http" Then
        StockBizWeb = "http://" + webAdress
    Else
        StockBizWeb = webAdress
    End If
    
ErrorHandler:
    Exit Function
End Function

Public Function StockBizExchange(stock_code)
    Dim objRequest As Object
    Dim strURL As String
    Dim token_1 As String
    Dim token_2 As String
    Dim json As Object
    Dim blnAsync As Boolean
    Dim strResponse As String
    
    token_1 = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm"
    token_1 = token_1 & "4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxOTcwNDY4OTYwLCJuYmYiOjE2NzA0Njg5NjAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiJjY2Q0OTZkZi0xZGJiLTRlOGQtODIxNC03NmVhMzJkMDI0YzkiLCJhdXRoX3RpbWUiOjE2NzA0Njg5NjAsImlkcCI6Imlkc3J2IiwibmFtZSI6ImJpdmFiaW4xMDBAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlZTJkZWY5NC03MGExLTQxODktYjlmZS01N2QyMmM3Mjk4NTkiLCJqdGkiOiJlYzEwNzUwNzZjMGEzNjg"
    
    token_2 = "wZDZjY2ExMDc2MWUyOWMyNCIsImFtciI6WyJwYXNzd29yZCJdfQ.VQYlpwEn8Qx6f9CiUVX7d6YP7x6QpfBrOs3td1bjicS1mpIneOO95yxRjDmYFdSFHNG1SpJwof0cvu6bfiuCcl08HPaQscOqv0497y-Z5L8qk9T4EDJfRtMauBTSiR8k1sv21W6-7qZvjTrgGdDWhGojYNadZs0hXnmV0wv-Kx9_bEkUhzt9O78QI9Y1Vb6pjBKhKMk0jQqlLmI_CqLlZ0JJk8Hgr9vcUX91JL5oIieyKcRfZ2gbcSfLpAxSxeEpkU4HWJ-C5B1rqokDjfAJ9fTHM_yRY6zmCz6PljEf0Xoc865br3lRWKSXhjSu127hIQlDmH_rVoZU9JdnekHsLA"
    
    Set objRequest = CreateObject("MSXML2.XMLHTTP")
    strURL = "https://api.fireant.vn/symbols/" & stock_code & "/profile"
    blnAsync = True
    
    With objRequest
        .Open "GET", strURL, blnAsync
        .SetRequestHeader "Content-Type", "application/json"
        .SetRequestHeader "Authorization", token_1 & token_2
        .Send
        
        While objRequest.readyState <> 4
            DoEvents
        Wend
        
        strResponse = .ResponseText
        
    End With
    
    Set json = JsonConverter.ParseJson(strResponse)
    If json("exchange") = "HSX" Then
        StockBizExchange = "HOSE"
    Else
        StockBizExchange = json("exchange")
    End If
End Function

Public Function StockBizWebStatus(webAddress)
    Dim objRequest As Object
    Dim blnAsync As Boolean
    'Dim webAddress As String
    'webAddress = "www.ckda.vn"
    If webAddress = "" Then
        blnAsync = False
    Else
        blnAsync = True
        If Left(webAddress, 4) <> "http" Then
            webAddress = "http://" + webAddress
        End If
    End If
    Set objRequest = CreateObject("MSXML2.XMLHTTP")
    With objRequest
        .Open "GET", webAddress, blnAsync
        .SetRequestHeader "Content-Type", "application/xml"
        .SetRequestHeader "User-Agent", "Mozilla/5.0 (Windows NT 6.1; rv:25.0) Gecko/20100101 Firefox/25.0"
        .Send
        
        While objRequest.readyState <> 4
            DoEvents
        Wend
        
        StockBizWebStatus = objRequest.Status
    End With
End Function

Function StockBizBusinessDescription(stockCode)
    Dim ie As New InternetExplorer
    Dim doc As New HTMLDocument
    Dim pageData As Object
    Dim bsnDesc As String
    
    On Error GoTo ErrorHandler
    
    ie.Visible = True
    ie.navigate "http://en.stockbiz.vn/Stocks/" + stockCode + "/Snapshot.aspx"
    Do
        DoEvents
    Loop Until ie.readyState = READYSTATE_COMPLETE
    
    Set doc = ie.document
    Set pageData = doc.querySelectorAll("table#ctl00_PlaceHolderContentArea_CenterZone tbody tr td table tbody tr td table.ctl00_PlaceHolderContentArea_CenterZone_1 tbody tr td.NoPadding div")(5)
    bsnDesc = pageData.innerText
    
    If bsnDesc = "" Then
        StockBizBusinessDescription = "-"
    Else
        StockBizBusinessDescription = Left(bsnDesc, Len(bsnDesc) - 1)
    End If
    
    ie.Quit
    
ErrorHandler:
    ie.Quit
    Exit Function
    
End Function
Sub StockBizICB()
    Dim ie As New InternetExplorer
    Dim doc As New HTMLDocument
    Dim tableData As Object
    Dim compnList As Object
    Dim compnCode As String
    Dim StBzNext As Object
    Dim NextLength As Long
    Dim cellCount As Long
    Dim NoIndex As Long
    Dim rowIndex As Long
    Dim cellTempIndex As Long
    Dim forIndex As Long
    Dim nextBoolean As Boolean
    Dim vneseName As String
    Dim stockCode As String
    
    
    Dim ICBnameStr_0 As String
    ICBnameStr_0 = "{""0001"":""Oil & Gas"",""0500"":""Oil & Gas"",""0530"":""Oil & Gas Producers"",""0533"":""Exploration & Production"",""0537"":""Integrated Oil & Gas"",""0570"":""Oil Equipment, Services & Distribution"",""0573"":""Oil Equipment & Services"",""0577"":""Pipelines"",""0580"":""Alternative Energy"",""0583"":""Renewable Energy Equipment"",""0587"":""Alternative Fuels""}"
    Dim ICBnameStr_1 As String
    ICBnameStr_1 = "{""1000"":""Basic Materials"",""1300"":""Chemicals"",""1350"":""Chemicals"",""1353"":""Commodity Chemicals"",""1357"":""Specialty Chemicals"",""1700"":""Basic Resources"",""1730"":""Forestry & Paper"",""1733"":""Forestry"",""1737"":""Paper"",""1750"":""Industrial Metals & Mining"",""1753"":""Aluminum"",""1755"":""Nonferrous Metals"",""1757"":""Iron & Steel"",""1770"":""Mining"",""1771"":""Coal"",""1773"":""Diamonds & Gemstones"",""1775"":""General Mining"",""1777"":""Gold Mining"",""1779"":""Platinum & Precious Metals""}"
    'cut at <= 272*
    Dim ICBnameStr_2_1 As String
    ICBnameStr_2_1 = "{""2000"":""Industrials"",""2300"":""Construction & Materials"",""2350"":""Construction & Materials"",""2353"":""Building Materials & Fixtures"",""2357"":""Heavy Construction"",""2700"":""Industrial Goods & Services"",""2710"":""Aerospace & Defense"",""2713"":""Aerospace"",""2717"":""Defense"",""2720"":""General Industrials"",""2723"":""Containers & Packaging"",""2727"":""Diversified Industrials""}"
    Dim ICBnameStr_2_2 As String
    ICBnameStr_2_2 = "{""2730"":""Electronic & Electrical Equipment"",""2733"":""Electrical Components & Equipment"",""2737"":""Electronic Equipment"",""2750"":""Industrial Engineering"",""2753"":""Commercial Vehicles & Trucks"",""2757"":""Industrial Machinery"",""2770"":""Industrial Transportation"",""2771"":""Delivery Services"",""2773"":""Marine Transportation"",""2775"":""Railroads"",""2777"":""Transportation Services"",""2779"":""Trucking"",""2790"":""Support Services"",""2791"":""Business Support Services"",""2793"":""Business Training & Employment Agencies"",""2795"":""Financial Administration"",""2797"":""Industrial Suppliers"",""2799"":""Waste & Disposal Services""}"
    'cut at <= 35**
    Dim ICBnameStr_3_1 As String
    ICBnameStr_3_1 = "{""3000"":""Consumer Goods"",""3300"":""Automobiles & Parts"",""3350"":""Automobiles & Parts"",""3353"":""Automobiles"",""3355"":""Auto Parts"",""3357"":""Tires"",""3500"":""Food & Beverage"",""3530"":""Beverages"",""3533"":""Brewers"",""3535"":""Distillers & Vintners"",""3537"":""Soft Drinks"",""3570"":""Food Producers"",""3573"":""Farming & Fishing"",""3577"":""Food Products""}"
    Dim ICBnameStr_3_2 As String
    ICBnameStr_3_2 = "{""3700"":""Personal & Household Goods"",""3720"":""Household Goods & Home Construction"",""3722"":""Durable Household Products"",""3724"":""Nondurable Household Products"",""3726"":""Furnishings"",""3728"":""Home Construction"",""3740"":""Leisure Goods"",""3743"":""Consumer Electronics"",""3745"":""Recreational Products"",""3747"":""Toys"",""3760"":""Personal Goods"",""3763"":""Clothing & Accessories"",""3765"":""Footwear"",""3767"":""Personal Products"",""3780"":""Tobacco"",""3785"":""Tobacco""}"
    Dim ICBnameStr_4 As String
    ICBnameStr_4 = "{""4000"":""Health Care"",""4500"":""Health Care"",""4530"":""Health Care Equipment & Services"",""4533"":""Health Care Providers"",""4535"":""Medical Equipment"",""4537"":""Medical Supplies"",""4570"":""Pharmaceuticals & Biotechnology"",""4573"":""Biotechnology"",""4577"":""Pharmaceuticals""}"
    Dim ICBnameStr_5 As String
    ICBnameStr_5 = "{""5000"":""Consumer Services"",""5300"":""Retail"",""5330"":""Food & Drug Retailers"",""5333"":""Drug Retailers"",""5337"":""Food Retailers & Wholesalers"",""5370"":""General Retailers"",""5371"":""Apparel Retailers"",""5373"":""Broadline Retailers"",""5375"":""Home Improvement Retailers"",""5377"":""Specialized Consumer Services"",""5379"":""Specialty Retailers"",""5500"":""Media"",""5550"":""Media"",""5553"":""Broadcasting & Entertainment"",""5555"":""Media Agencies"",""5557"":""Publishing"",""5700"":""Travel & Leisure"",""5750"":""Travel & Leisure"",""5751"":""Airlines"",""5752"":""Gambling"",""5753"":""Hotels"",""5755"":""Recreational Services"",""5757"":""Restaurants & Bars"",""5759"":""Travel & Tourism""}"
    Dim ICBnameStr_6 As String
    ICBnameStr_6 = "{""6000"":""Telecommunications"",""6500"":""Telecommunications"",""6530"":""Fixed Line Telecommunications"",""6535"":""Fixed Line Telecommunications"",""6570"":""Mobile Telecommunications"",""6575"":""Mobile Telecommunications""}"
    Dim ICBnameStr_7 As String
    ICBnameStr_7 = "{""7000"":""Utilities"",""7500"":""Utilities"",""7530"":""Electricity"",""7535"":""Conventional Electricity"",""7537"":""Alternative Electricity"",""7570"":""Gas, Water & Multiutilities"",""7573"":""Gas Distribution"",""7575"":""Multiutilities"",""7577"":""Water""}"
    'cut at <= 85**
    Dim ICBnameStr_8_1 As String
    ICBnameStr_8_1 = "{""8000"":""Financials"",""8300"":""Banks"",""8350"":""Banks"",""8355"":""Banks"",""8500"":""Insurance"",""8530"":""Nonlife Insurance"",""8532"":""Full Line Insurance"",""8534"":""Insurance Brokers"",""8536"":""Property & Casualty Insurance"",""8538"":""Reinsurance"",""8570"":""Life Insurance"",""8575"":""Life Insurance""}"
    Dim ICBnameStr_8_2 As String
    ICBnameStr_8_2 = "{""8600"":""Real Estate"",""8630"":""Real Estate Investment & Services"",""8633"":""Real Estate Holding & Development"",""8637"":""Real Estate Services"",""8670"":""Real Estate Investment Trusts"",""8671"":""Industrial & Office REITs"",""8672"":""Retail REITs"",""8673"":""Residential REITs"",""8674"":""Diversified REITs"",""8675"":""Specialty REITs"",""8676"":""Mortgage REITs"",""8677"":""Hotel & Lodging REITs"",""8700"":""Financial Services"",""8770"":""Financial Services"",""8771"":""Asset Managers"",""8773"":""Consumer Finance"",""8775"":""Specialty Finance"",""8777"":""Investment Services"",""8779"":""Mortgage Finance"",""8900"":""Equity/Nonequity Investments"",""8980"":""Equity Investment Instruments"",""8985"":""Equity Investment Instruments"",""8990"":""Nonequity Investment Instruments"",""8995"":""Nonequity Investment Instruments""}"
    Dim ICBnameStr_9 As String
    ICBnameStr_9 = "{""9000"":""Technology"",""9500"":""Technology"",""9530"":""Software & Computer Services"",""9533"":""Computer Services"",""9535"":""Internet"",""9537"":""Software"",""9570"":""Technology Hardware & Equipment"",""9572"":""Computer Hardware"",""9574"":""Electronic Office Equipment"",""9576"":""Semiconductors"",""9578"":""Telecommunications Equipment""}"
    
    On Error GoTo ErrorHandler
    
    Range("B:XFD").Clear
    Range("A:A").Rows.RowHeight = 15
    With Range("B:XFD").Font
        .Name = "Georgia"
        .Size = 11
    End With
    
    Dim iRange As Range
    Set iRange = Range(Cells(2, 7), Cells(2, 8))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Stockbiz"
        .Interior.Color = HexToRGB("BF8F00")
        .Font.Color = vbWhite
        .Font.Bold = True
    End With
    Set iRange = Range(Cells(2, 9), Cells(2, 11))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Company's website"
        .Interior.Color = HexToRGB("FF0000")
        .Font.Color = vbWhite
        .Font.Bold = True
    End With
    Set iRange = Range(Cells(2, 12), Cells(2, 14))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Annual Report / Unconsolidated Financial Statement 31/12/2021"
        .Interior.Color = HexToRGB("FFC000")
        .Font.Color = vbBlack
        .Font.Bold = True
    End With
    Set iRange = Range(Cells(2, 15), Cells(2, 17))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Rejection reason"
        .Interior.Color = HexToRGB("92D050")
        .Font.Color = vbBlack
        .Font.Bold = True
    End With
    Cells(3, 2) = "No."
    Columns(2).ColumnWidth = 5.86
    Cells(3, 3) = "Vietnamese Name"
    Columns(3).ColumnWidth = 42
    Cells(3, 4) = "English Name"
    Columns(4).ColumnWidth = 42
    Cells(3, 5) = "Listed name"
    Columns(5).ColumnWidth = 8.71
    Cells(3, 6) = "Listed in"
    Columns(6).ColumnWidth = 8.86
    Cells(3, 7) = "Business Description"
    Columns(7).ColumnWidth = 46.43
    Cells(3, 8) = "Biggest shareholder"
    Columns(8).ColumnWidth = 37.43
    Cells(3, 9) = "Website"
    Columns(9).ColumnWidth = 26.57
    Cells(3, 10) = "Website obtained from web search"
    Columns(10).ColumnWidth = 13
    Cells(3, 11) = "Website Description"
    Columns(11).ColumnWidth = 44.86
    Cells(3, 12) = "Business description" & vbNewLine & "FY2021"
    Columns(12).ColumnWidth = 33.71
    Cells(3, 13) = "Business segment" & vbNewLine & "FY2021"
    Columns(13).ColumnWidth = 33.71
    Cells(3, 14) = "Biggest shareholder" & vbNewLine & "FY2021"
    Columns(14).ColumnWidth = 33.71
    Cells(3, 15) = "Non-independence (25%)"
    Columns(15).ColumnWidth = 12
    Cells(3, 16) = "Different functions"
    Columns(16).ColumnWidth = 12
    Cells(3, 17) = "Different products"
    Columns(17).ColumnWidth = 12
    Cells(3, 18) = "Accept/Reject"
    Columns(18).ColumnWidth = 12
    Cells(3, 19) = "Comments"
    Columns(19).ColumnWidth = 36
    Cells(3, 20) = "Notes"
    Columns(20).ColumnWidth = 22.71
    Rows(3).RowHeight = 59.25
    Rows(3).WrapText = True
    With Range(Cells(3, 2), Cells(3, 20))
        .Interior.Color = HexToRGB("C00000")
        .Font.Color = vbWhite
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Set iRange = Range(Cells(3, 2), Cells(3, 20))
    For Each iCell In iRange
        iCell.BorderAround _
            LineStyle:=xlContinuous, _
            Weight:=xlThin
    Next iCell
    
    rowIndex = 4
    ie.Visible = True
    
    Dim json As Object
    For Each cell In Range("A1:A20")
        stockCode = cell.Value
        
        If stockCode <> "" Then
            If Left(stockCode, 1) = "0" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_0)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "1" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_1)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "2" Then
                If CInt(Left(stockCode, 3)) <= 272 Then
                    Set json = JsonConverter.ParseJson(ICBnameStr_2_1)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                Else
                    Set json = JsonConverter.ParseJson(ICBnameStr_2_2)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                End If
            ElseIf Left(stockCode, 1) = "3" Then
                If CInt(Left(stockCode, 2)) <= 35 Then
                    Set json = JsonConverter.ParseJson(ICBnameStr_3_1)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                Else
                    Set json = JsonConverter.ParseJson(ICBnameStr_3_2)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                End If
            ElseIf Left(stockCode, 1) = "4" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_4)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "5" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_5)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "6" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_6)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "7" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_6)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            ElseIf Left(stockCode, 1) = "8" Then
                If CInt(Left(stockCode, 2)) <= 85 Then
                    Set json = JsonConverter.ParseJson(ICBnameStr_8_1)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                Else
                    Set json = JsonConverter.ParseJson(ICBnameStr_8_2)
                    Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
                End If
            ElseIf Left(stockCode, 1) = "9" Then
                Set json = JsonConverter.ParseJson(ICBnameStr_9)
                Cells(rowIndex, 2) = stockCode + " - " + json(stockCode)
            End If
            
            'Cells(rowIndex, 2) = "'" + stockCode
            cellTempIndex = rowIndex
            rowIndex = rowIndex + 1
            ie.navigate "https://www.stockbiz.vn/IndustryOverview.aspx?Code=" & stockCode
            Do
                DoEvents
            Loop Until ie.readyState = READYSTATE_COMPLETE
            Set doc = ie.document
            Set tableData = doc.querySelector("table.dataTable tbody")
    
            'rowIndex =
            Do
                Set doc = ie.document
                Set tableData = doc.querySelector("table.dataTable tbody")
                If tableData Is Nothing Then
                    Exit Do
                End If
                If doc.querySelector("table.dataTable tbody").Children.Length = 21 Then
                    nextBoolean = True
                Else
                    nextBoolean = False
                End If
            
                forIndex = tableData.Children.Length - 1
                For i = 1 To forIndex
                    NoIndex = NoIndex + 1
                    'Set compnList = tableData.Children.Item(i).Children.Item(0)
                    vneseName = Left(tableData.Children.Item(i).Children.Item(1).innerText, Len(tableData.Children.Item(i).Children.Item(1).innerText) - 1)
                    compnCode = tableData.Children.Item(i).Children.Item(0).innerText
                    compnCode = Left(compnCode, Len(compnCode) - 2)
                    Cells(rowIndex, 5) = compnCode
                    Cells(rowIndex, 5).HorizontalAlignment = xlCenterAcrossSelection
                    Cells(rowIndex, 2) = NoIndex
                    Cells(rowIndex, 2).HorizontalAlignment = xlCenterAcrossSelection
                    Cells(rowIndex, 3) = Left(vneseName, Len(vneseName))
                    'Cells(rowIndex, 3) = StockBizEnglishName(compnCode)
                    'Cells(rowIndex, 6) = StockBizExchange(compnCode)
                    Cells(rowIndex, 6).HorizontalAlignment = xlCenterAcrossSelection
                    'Cells(rowIndex, 6) = StockBizShareholder(compnCode)
                    'Cells(crowIndex, 7) = StockBizWeb(compnCode)
                    Cells(rowIndex, 18).Formula = "=if(" & Cells(rowIndex, 19).Address(False, False) & "="""",""Accept"",""Reject"")"
                    Cells(rowIndex, 18).HorizontalAlignment = xlCenterAcrossSelection
                    
                    
                    With Range(Cells(rowIndex, 2), Cells(rowIndex, 20))
                        .RowHeight = 49.5
                        .VerticalAlignment = xlCenter
                        .WrapText = True
                    End With
                    
                    For Each iCell In Range(Cells(rowIndex, 2), Cells(rowIndex, 20))
                        iCell.BorderAround _
                            LineStyle:=xlContinuous, _
                            Weight:=xlThin
                    Next iCell
                    
                    rowIndex = rowIndex + 1
                Next i
                cellCount = cellCount + i - 1
                
                NextLength = doc.querySelector("div.pageNavigation").Children.Length
                NextLength = NextLength - 1
                Set StBzNext = doc.querySelector("div.pageNavigation").Children.Item(NextLength)
                StBzNext.Click
                Application.Wait Now + #12:00:02 AM#
            Loop While nextBoolean = True
                
            With Range(Cells(cellTempIndex, 2), Cells(cellTempIndex, 20))
                .Font.Bold = True
                .Interior.Color = HexToRGB("F8CBAD")
                .RowHeight = 14.25

            End With
            
            For Each iCell In Range(Cells(cellTempIndex, 2), Cells(cellTempIndex, 20))
                iCell.BorderAround _
                LineStyle:=xlContinuous, _
                Weight:=xlThin
            Next iCell
            
            If rowIndex - cellTempIndex = 1 Then
                Cells(cellTempIndex, 3) = "0 company"
            ElseIf rowIndex - cellTempIndex = 2 Then
                Cells(cellTempIndex, 3) = "1 company"
            Else
                Cells(cellTempIndex, 3) = rowIndex - cellTempIndex - 1 & " companies"
            End If
        End If
    Next cell
    ie.Quit
ErrorHandler:
    ie.Quit
    Exit Sub
End Sub
Function HexToRGB(sHexVal As String) As Long
    
Dim lRed As Long
Dim lGreen As Long
Dim lBlue As Long

lRed = CLng("&H" & Left$(sHexVal, 2))
lGreen = CLng("&H" & Mid$(sHexVal, 3, 2))
lBlue = CLng("&H" & Right$(sHexVal, 2))

HexToRGB = RGB(lRed, lGreen, lBlue)

End Function

Sub createLink()
    Dim runIndex As Integer
    Dim runBln As Boolean
    Dim i As LongLong
    Dim stockCode As String
    
    runBln = True
    runIndex = 0
    i = 2
    
    Do While runBln = True
        If IsEmpty(Cells(i, 1)) = True Then
            runIndex = runIndex + 1
        Else
            stockCode = Cells(i, 1).Value
            stockCode = Replace(stockCode, " ", "")
            ActiveCell.Hyperlinks.Add Anchor:=Cells(i, 2), Address:="http://en.stockbiz.vn/Stocks/" + stockCode + "/Snapshot.aspx"
            Cells(i, 2).Font.Size = 16
            Rows(i).RowHeight = 30
            Rows(i).VerticalAlignment = xlCenter
            runIndex = 0
        End If
        
        If runIndex = 70 Then
            runBln = False
        End If
        i = i + 1
    Loop
End Sub
Sub StockBizICBAll()
    Range("A:XFD").ClearContents
    
    Dim ICBList As Variant
    'ICBList = Array("0533", "0537", "0573", "0577", "0583", "0587", "1353", "1357", "1733", "1737", "1753", "1755", "1757", "1771", "1773", "1775", "1777", "1779", "2353", "2357", "2713", "2717", "2723", "2727", "2733", "2737", "2753", "2757", "2771", "2773", "2775", "2777", "2779", "2791", "2793", "2795", "2797", "2799", "3353", "3355", "3357", "3533", "3535", "3537", "3573", "3577", "3722", "3724", "3726", "3728", "3743", "3745", "3747", "3763", "3765", "3767", "3785", "4533", "4535", "4537", "4573", "4577", "5333", "5337", "5371", "5373", "5375", "5377", "5379", "5553", "5555", "5557", "5751", "5752", "5753", "5755", "5759", "6535", "6575", "7535", "7537", "7573", "7575", "7577", "8355", "8532", "8534", "8536", "8538", "8575", "8581", "8633", "8637", "8671", "8672", "8673", "8674", "8675", "8676", "8677", "8771", "8773", "8775", "8777", "8779", "8781", "8985", "8995", "9533", "9535", "9537", "9572", "9574", "9576", "9578")
    ICBList = Array("2357")
    
    Dim rowIndex As Integer
    rowIndex = 1
    
    Dim ie As New InternetExplorer
    ie.Silent = True
    ie.Visible = True
    
    'Loop in all ICB codes
    
    
    Dim compnList As Object
    Dim compnCode As String
    Dim StBzNext As Object
    Dim NextLength As Long
    Dim cellCount As Long
    Dim forIndex As Long
    Dim nextBoolean As Boolean
    Dim ICBIndex As Integer
    For ICBIndex = 0 To 114
        With ie
            .navigate "https://www.stockbiz.vn/IndustryOverview.aspx?Code=" & ICBList(ICBIndex)
        End With
        Do
            DoEvents
        Loop Until ie.readyState = READYSTATE_COMPLETE
        
        Dim doc As New HTMLDocument
        Set doc = ie.document
        
        Dim tableData As Object
        Set tableData = doc.querySelector("table.dataTable tbody")
        
        Dim test As Object
        Set test = doc.querySelector("div.pageNavigation").Children
        Dim testStr As Integer
        testStr = CInt(doc.querySelector("div.pageNavigation").Children.Length) - 1
        Set test = doc.querySelector("div.pageNavigation").Children.Item(testStr)
        
        Do
            If tableData Is Nothing Then
                Exit Do
            Else
                Dim pageNavigationInt As Integer
                pageNavigationInt = CInt(doc.querySelector("div.pageNavigation").Children.Length) - 1
                'doc.querySelector("div.pageNavigation").Children.Item(doc.querySelector("div.pageNavigation").Children.Length).Click
                nextBoolean = True
            End If
            
            Set doc = ie.document
            Set tableData = doc.querySelector("table.dataTable tbody")
            
            forIndex = tableData.Children.Length - 1
            If forIndex > 0 Then
                For i = 1 To forIndex
                    'Set compnList = tableData.Children.Item(i).Children.Item(0)
                    vneseName = Left(tableData.Children.Item(i).Children.Item(1).innerText, Len(tableData.Children.Item(i).Children.Item(1).innerText) - 1)
                    compnCode = tableData.Children.Item(i).Children.Item(0).innerText
                    If compnCode = "" Then
                        Exit For
                    Else
                        compnCode = Left(compnCode, Len(compnCode) - 2)
                    End If
                    Cells(rowIndex, 4) = compnCode
                    Cells(rowIndex, 1) = rowIndex - ICBIndex - 1
                    Cells(rowIndex, 2) = Left(vneseName, Len(vneseName))
                    Cells(rowIndex, 3) = StockBizEnglishName(compnCode)
                    Cells(rowIndex, 5) = StockBizExchange(compnCode)
                    Cells(rowIndex, 6) = StockBizBusinessDescription(compnCode)
                    Cells(rowIndex, 7) = StockBizShareholder(compnCode)
                    Cells(rowIndex, 8) = StockBizWeb(compnCode)
                    rowIndex = rowIndex + 1
                Next i
            End If
            
            NextLength = doc.querySelector("div.pageNavigation").Children.Length
            NextLength = NextLength - 1
            Set StBzNext = doc.querySelector("div.pageNavigation").Children.Item(NextLength)
            StBzNext.Click
            Application.Wait Now + #12:00:02 AM#
        Loop While nextBoolean = True
    Next ICBIndex
    ie.Quit
End Sub
Public Sub VNeseFS()
    Dim stock_code As String
    stock_code = Cells(1, 1).Value
    Range("A2:XFD1048576").ClearContents
    Range("A2:XFD1048576").ClearFormats
    Range("B2:XFD1048576").ClearContents
    Range("B2:XFD1048576").ClearFormats
    
    Dim token_1 As String
    Dim token_2 As String
    Dim objRequest As Object
    Dim blnAsync As Boolean
    Dim strResponse As String
    token_1 = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm"
    token_1 = token_1 & "4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxOTcwNDY4OTYwLCJuYmYiOjE2NzA0Njg5NjAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiJjY2Q0OTZkZi0xZGJiLTRlOGQtODIxNC03NmVhMzJkMDI0YzkiLCJhdXRoX3RpbWUiOjE2NzA0Njg5NjAsImlkcCI6Imlkc3J2IiwibmFtZSI6ImJpdmFiaW4xMDBAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlZTJkZWY5NC03MGExLTQxODktYjlmZS01N2QyMmM3Mjk4NTkiLCJqdGkiOiJlYzEwNzUwNzZjMGEzNjg"
    token_2 = "wZDZjY2ExMDc2MWUyOWMyNCIsImFtciI6WyJwYXNzd29yZCJdfQ.VQYlpwEn8Qx6f9CiUVX7d6YP7x6QpfBrOs3td1bjicS1mpIneOO95yxRjDmYFdSFHNG1SpJwof0cvu6bfiuCcl08HPaQscOqv0497y-Z5L8qk9T4EDJfRtMauBTSiR8k1sv21W6-7qZvjTrgGdDWhGojYNadZs0hXnmV0wv-Kx9_bEkUhzt9O78QI9Y1Vb6pjBKhKMk0jQqlLmI_CqLlZ0JJk8Hgr9vcUX91JL5oIieyKcRfZ2gbcSfLpAxSxeEpkU4HWJ-C5B1rqokDjfAJ9fTHM_yRY6zmCz6PljEf0Xoc865br3lRWKSXhjSu127hIQlDmH_rVoZU9JdnekHsLA"
    
    Set objRequest = CreateObject("MSXML2.XMLHTTP")
    strURL = "https://restv2.fireant.vn/symbols/" & stock_code & "/full-financial-reports?type=2&year=2023&quarter=0&limit=5"
    blnAsync = True
    
    With objRequest
        .Open "GET", strURL, blnAsync
        .SetRequestHeader "Content-Type", "application/json"
        .SetRequestHeader "Authorization", token_1 & token_2
        .Send
        
        While objRequest.readyState <> 4
            DoEvents
        Wend
        
        strResponse = .ResponseText
        
    End With
    
    Dim json As Object
    Set json = JsonConverter.ParseJson(strResponse)
    
    Cells(2, 1) = "Net Sales"
    Cells(3, 1) = "COGS"
    Cells(4, 1) = "Gross Profit"
    Cells(5, 1) = "Selling Expense"
    Cells(6, 1) = "G&A Expense"
    Cells(7, 1) = "EBIT"
    Cells(8, 1) = "Total Costs"
    Cells(9, 1) = "ROS"
    Cells(10, 1) = "MOTC"
    
    Dim forLength As Integer
    forLength = json.Item(4)("values").Count
    Dim yearIndex As Integer
    Dim ObjTemp As Object
    For i = 1 To json.Item(4)("values").Count
        yearIndex = forLength - i + 1
        'Retrieve Net Sales
        Set ObjTemp = json.Item(3)("values")
        Set ObjTemp = ObjTemp.Item(yearIndex)
        Cells(1, i + 1) = ObjTemp("year")
        Cells(2, i + 1) = Format(ObjTemp("value"), "#,###")
        'Retrieve COGS
        Set ObjTemp = json.Item(4)("values")
        Set ObjTemp = ObjTemp.Item(yearIndex)
        Cells(3, i + 1) = Format(ObjTemp("value"), "#,###")
        'Calculate Gross Profit
        Cells(4, i + 1).Formula = "=" & Cells(2, i + 1).Address(False, False) & "-" & Cells(3, i + 1).Address(False, False)
        'Retrieve Selling Expense
        Set ObjTemp = json.Item(10)("values")
        Set ObjTemp = ObjTemp.Item(yearIndex)
        Cells(5, i + 1) = Format(ObjTemp("value"), "#,###")
        'Retrieve G&A Expense
        Set ObjTemp = json.Item(11)("values")
        Set ObjTemp = ObjTemp.Item(yearIndex)
        Cells(6, i + 1) = Format(ObjTemp("value"), "#,###")
        'Calculate EBIT
        Cells(7, i + 1).Formula = "=" & Cells(4, i + 1).Address(False, False) & "-" & Cells(5, i + 1).Address(False, False) & "-" & Cells(6, i + 1).Address(False, False)
        'Calculate Total Costs
        Cells(8, i + 1).Formula = "=" & Cells(2, i + 1).Address(False, False) & "-" & Cells(7, i + 1).Address(False, False)
        'Calculate ROS
        Cells(9, i + 1).Formula = "=" & Cells(7, i + 1).Address(False, False) & "/" & Cells(2, i + 1).Address(False, False)
        Cells(9, i + 1).NumberFormat = "0.00%"
        'Calculate MOTC
        Cells(10, i + 1).Formula = "=" & Cells(7, i + 1).Address(False, False) & "/" & Cells(8, i + 1).Address(False, False)
        Cells(10, i + 1).NumberFormat = "0.00%"
    Next i
End Sub
Public Sub VNeseFS_Beta()

    Dim yearStart As String
    yearStart = Cells(1, 1).Value
    Dim noFS As Integer
    noFS = CInt(Cells(1, 2).Value)
    
    Range("A4:XFD1048576").ClearContents
    Range("A4:XFD1048576").ClearFormats
    
    Dim token_1 As String
    Dim token_2 As String
    Dim objRequest As Object
    Dim blnAsync As Boolean
    Dim strResponse As String
    token_1 = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm"
    token_1 = token_1 & "4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxOTcwNDY4OTYwLCJuYmYiOjE2NzA0Njg5NjAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiJjY2Q0OTZkZi0xZGJiLTRlOGQtODIxNC03NmVhMzJkMDI0YzkiLCJhdXRoX3RpbWUiOjE2NzA0Njg5NjAsImlkcCI6Imlkc3J2IiwibmFtZSI6ImJpdmFiaW4xMDBAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlZTJkZWY5NC03MGExLTQxODktYjlmZS01N2QyMmM3Mjk4NTkiLCJqdGkiOiJlYzEwNzUwNzZjMGEzNjg"
    token_2 = "wZDZjY2ExMDc2MWUyOWMyNCIsImFtciI6WyJwYXNzd29yZCJdfQ.VQYlpwEn8Qx6f9CiUVX7d6YP7x6QpfBrOs3td1bjicS1mpIneOO95yxRjDmYFdSFHNG1SpJwof0cvu6bfiuCcl08HPaQscOqv0497y-Z5L8qk9T4EDJfRtMauBTSiR8k1sv21W6-7qZvjTrgGdDWhGojYNadZs0hXnmV0wv-Kx9_bEkUhzt9O78QI9Y1Vb6pjBKhKMk0jQqlLmI_CqLlZ0JJk8Hgr9vcUX91JL5oIieyKcRfZ2gbcSfLpAxSxeEpkU4HWJ-C5B1rqokDjfAJ9fTHM_yRY6zmCz6PljEf0Xoc865br3lRWKSXhjSu127hIQlDmH_rVoZU9JdnekHsLA"
    blnAsync = True
    
    Dim iRange As Range
    Dim columnIndex As Integer
    columnIndex = 1
    'Header
    Dim itemArray As Variant
    itemArray = Array("No.", "Vietnamese Name", "English Name", "Listed Name", "Listed in", "Province")
    For Each Item In itemArray
        Set iRange = Range(Cells(4, columnIndex), Cells(5, columnIndex))
        With iRange
            .Merge
            .HorizontalAlignment = xlCenterAcrossSelection
            .VerticalAlignment = xlCenter
            .Value = Item
        End With
        columnIndex = columnIndex + 1
    Next Item
    'Closing date
    Set iRange = Range(Cells(4, columnIndex), Cells(4, columnIndex + noFS - 1))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Closing date"
    End With
    For i = 1 To noFS
        Cells(5, columnIndex + i - 1) = CInt(yearStart) - i + 1
        Cells(5, columnIndex + i - 1).VerticalAlignment = xlCenter
        Cells(5, columnIndex + i - 1).HorizontalAlignment = xlCenterAcrossSelection
    Next i
    columnIndex = columnIndex + noFS
    
    itemArray = Array("Sales", "Cost of goods sold", "Gross Profit", "Selling expenses", "SG & A", "EBIT")
    For Each Item In itemArray
        Set iRange = Range(Cells(4, columnIndex), Cells(4, columnIndex + noFS - 1 + 2))
        With iRange
            .Merge
            .HorizontalAlignment = xlCenterAcrossSelection
            .VerticalAlignment = xlCenter
            .Value = Item
        End With
        For i = 1 To noFS
            Cells(5, columnIndex + i - 1) = CInt(yearStart) - i + 1
            Cells(5, columnIndex + i - 1).VerticalAlignment = xlCenter
            Cells(5, columnIndex + i - 1).HorizontalAlignment = xlCenterAcrossSelection
        Next i
        columnIndex = columnIndex + noFS
        Cells(5, columnIndex) = "Average"
        Cells(5, columnIndex).VerticalAlignment = xlCenter
        Cells(5, columnIndex).HorizontalAlignment = xlCenterAcrossSelection
        columnIndex = columnIndex + 1
        Cells(5, columnIndex) = "Summation"
        Cells(5, columnIndex).VerticalAlignment = xlCenter
        Cells(5, columnIndex).HorizontalAlignment = xlCenterAcrossSelection
        columnIndex = columnIndex + 1
    Next Item
    'Total Cost
    Set iRange = Range(Cells(4, columnIndex), Cells(4, columnIndex + noFS - 1 + 1))
    With iRange
        .Merge
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
        .Value = "Total Cost"
    End With
    For i = 1 To noFS
        Cells(5, columnIndex + i - 1) = CInt(yearStart) - i + 1
        Cells(5, columnIndex + i - 1).VerticalAlignment = xlCenter
        Cells(5, columnIndex + i - 1).HorizontalAlignment = xlCenterAcrossSelection
    Next i
    columnIndex = columnIndex + noFS
    Cells(5, columnIndex) = "Summation"
    Cells(5, columnIndex).VerticalAlignment = xlCenter
    Cells(5, columnIndex).HorizontalAlignment = xlCenterAcrossSelection
    columnIndex = columnIndex + 1
    
    itemArray = Array("Return on Sales (ROS)", "Mark Up on Total Cost(MOTC)")
    For Each Item In itemArray
        Set iRange = Range(Cells(4, columnIndex), Cells(4, columnIndex + noFS - 1 + 1))
        With iRange
            .Merge
            .HorizontalAlignment = xlCenterAcrossSelection
            .VerticalAlignment = xlCenter
            .Value = Item
        End With
        For i = 1 To noFS
            Cells(5, columnIndex + i - 1) = CInt(yearStart) - i + 1
            Cells(5, columnIndex + i - 1).VerticalAlignment = xlCenter
            Cells(5, columnIndex + i - 1).HorizontalAlignment = xlCenterAcrossSelection
        Next i
        columnIndex = columnIndex + noFS
        Cells(5, columnIndex) = "Average"
        Cells(5, columnIndex).VerticalAlignment = xlCenter
        Cells(5, columnIndex).HorizontalAlignment = xlCenterAcrossSelection
        columnIndex = columnIndex + 1
    Next Item
    
    Dim StrTest As String
    
    Dim json As Object
    Dim itemCount As Integer
    itemCount = 1
    Dim yearIndex As Integer
    Dim ObjTemp As Object
    For Each cell In Rows(2).Value
        If IsEmpty(cell) = True Then
            Exit For
        End If
        
        Set objRequest = CreateObject("MSXML2.XMLHTTP")
        strURL = "https://restv2.fireant.vn/symbols/" & cell & "/full-financial-reports?type=2&year=2023&quarter=0&limit=6"
        With objRequest
            .Open "GET", strURL, blnAsync
            .SetRequestHeader "Content-Type", "application/json"
            .SetRequestHeader "Authorization", token_1 & token_2
            .Send
            While objRequest.readyState <> 4
                DoEvents
            Wend
            strResponse = .ResponseText
        End With
        Set json = JsonConverter.ParseJson(strResponse)
        
        'Index of yearStart
        yearIndex = 0
        Set ObjTemp = json.Item(3)("values")
        For i = 1 To ObjTemp.Count
            If ObjTemp.Item(i)("period") = yearStart Then
                yearIndex = i
            End If
        Next i
        'No.
        Cells(5 + itemCount, 1) = itemCount
        'Listed Name
        Cells(5 + itemCount, 4) = cell
        If yearIndex = 0 Then
            GoTo ExitLoop
        End If
        'Vietnamese Name
        'Cells(5 + itemCount, 2) = StockBizVNeseName(cell)
        'English Name
        'Cells(5 + itemCount, 3) = StockBizEnglishName(cell)

        'Listed in
        'Cells(5 + itemCount, 5) = StockBizExchange(cell)
        'Closing date
        columnIndex = 7 + noFS
        '   Net Sales
        'YoY
        exitFor = False
        For i = 1 To noFS
            Set ObjTemp = json.Item(3)("values")
            Set ObjTemp = ObjTemp.Item(yearIndex - i + 1)
           
            Cells(5 + itemCount, columnIndex) = Format(ObjTemp("value"), "0,000")
            columnIndex = columnIndex + 1
        Next i
        If exitFor = True Then
            Exit For
        End If
        'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   COGS
        'YoY
        For i = 1 To noFS
            Set ObjTemp = json.Item(4)("values")
            Set ObjTemp = ObjTemp.Item(yearIndex - i + 1)
            Cells(5 + itemCount, columnIndex) = Format(ObjTemp("value"), "0,000")
            columnIndex = columnIndex + 1
        Next i
        'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   Gross Profit
        'YoY
        For i = 1 To noFS
            Cells(5 + itemCount, columnIndex).Formula = "=" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 2).Address(False, False) & "-" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 1).Address(False, False)
            columnIndex = columnIndex + 1
        Next i
        'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   Selling expenses
        'YoY
        For i = 1 To noFS
            Set ObjTemp = json.Item(10)("values")
            Set ObjTemp = ObjTemp.Item(yearIndex - i + 1)
            Cells(5 + itemCount, columnIndex) = Format(ObjTemp("value"), "0,000")
            columnIndex = columnIndex + 1
        Next i
        'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   SG & A
        'YoY
        For i = 1 To noFS
            Set ObjTemp = json.Item(11)("values")
            Set ObjTemp = ObjTemp.Item(yearIndex - i + 1)
            Cells(5 + itemCount, columnIndex) = Format(ObjTemp("value"), "0,000")
            columnIndex = columnIndex + 1
        Next i
        'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   EBIT
        'YoY
        For i = 1 To noFS
            Cells(5 + itemCount, columnIndex).Formula = "=" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 3).Address(False, False) & "-" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 2).Address(False, False) & "-" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 1).Address(False, False)
            columnIndex = columnIndex + 1
        Next i
                'Calculate Average
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "average(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000.00"
        columnIndex = columnIndex + 1
        'Calculate Summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - 1 - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1 - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   Total Cost
        'YoY
        For i = 1 To noFS
            Cells(5 + itemCount, columnIndex).Formula = "=if(or(" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 6).Address(False, False) & "=0," & Cells(5 + itemCount, columnIndex - (noFS + 2) * 6).Address(False, False) & "=""""," & Cells(5 + itemCount, columnIndex - (noFS + 2) * 1).Address(False, False) & "=""""),""""," & Cells(5 + itemCount, columnIndex - (noFS + 2) * 6).Address(False, False) & "-" & Cells(5 + itemCount, columnIndex - (noFS + 2) * 1).Address(False, False) & ")"
            Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
            columnIndex = columnIndex + 1
        Next i
        'summation
        Cells(5 + itemCount, columnIndex).Formula = "=if(countblank(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & ")=3,""""," & "sum(" & Cells(5 + itemCount, columnIndex - noFS).Address(False, False) & ":" & Cells(5 + itemCount, columnIndex - 1).Address(False, False) & "))"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0,000"
        columnIndex = columnIndex + 1
        '   ROS
        'YoY
        For i = 1 To noFS
            Cells(5 + itemCount, columnIndex).Formula = "=if(or(or(" & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 7).Address(False, False) & "=""""," & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 2).Address(False, False) & "=""""),or(" & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 7).Address(False, False) & "=0," & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 2).Address(False, False) & "="""")),""""," & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 2).Address(False, False) & "/" & Cells(5 + itemCount, columnIndex + 1 - (noFS + 2) * 7).Address(False, False) & ")"
            Cells(5 + itemCount, columnIndex).NumberFormat = "0.00%"
            columnIndex = columnIndex + 1
        Next i
        'Average
        Cells(5 + itemCount, columnIndex).Formula = "=iferror(" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2).Address(False, False) & "/" & Cells(5 + itemCount, columnIndex + 2 - (noFS + 2) * 7).Address(False, False) & ","""")"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0.00%"
        columnIndex = columnIndex + 1
        '   MOTC
        'YoY
        For i = 1 To noFS
            Cells(5 + itemCount, columnIndex).Formula = "=if(or(or(" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2 - (noFS + 2)).Address(False, False) & "=""""," & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2).Address(False, False) & "=""""),or(" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2 - (noFS + 2)).Address(False, False) & "=""""," & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2).Address(False, False) & "=0)),""""," & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2 - (noFS + 2)).Address(False, False) & "/" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2).Address(False, False) & ")"
            Cells(5 + itemCount, columnIndex).NumberFormat = "0.00%"
            columnIndex = columnIndex + 1
        Next i
        'Average
        Cells(5 + itemCount, columnIndex).Formula = "=iferror(" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 3).Address(False, False) & " /" & Cells(5 + itemCount, columnIndex - (noFS + 1) * 2).Address(False, False) & ","""")"
        Cells(5 + itemCount, columnIndex).NumberFormat = "0.00%"
        columnIndex = columnIndex + 1
ExitLoop:
        itemCount = itemCount + 1
    Next cell
End Sub
Public Sub VNeseFS_Test(stockCode As String, studyyear As Integer)
    Dim ie As New InternetExplorer
    Dim doc As New HTMLDocument
    Dim pageData As Object
    Dim shData As String
    Dim NSStr As String
    Dim NS As LongLong
    Dim COGSStr As String
    Dim COGS As LongLong
    Dim SEStr As String
    Dim SE As LongLong
    Dim GAEStr As String
    Dim GAE As LongLong
    'Dim stockcode As String
    'stockcode = "ST8"
    'Dim studyyear As Integer
    'studyyear = 2020
    Dim testVar As Object
    Range("A2:XFD1048576").ClearContents
        
    On Error GoTo ErrorHandler
        
    ie.Visible = True
    ie.navigate "https://congbothongtin.ssc.gov.vn/"
    Do
        DoEvents
    Loop Until ie.readyState = READYSTATE_COMPLETE

    Set doc = ie.document
    'Set testVar = doc.querySelector("ul#pt9\:smc2\:\:pop").Children.Item(1).Children.Item(0).Children.Item(2)
    doc.querySelector("input#pt9\:it8112\:\:content").Value = stockCode
    doc.querySelector("ul#pt9\:smc2\:\:pop").Children.Item(1).Children.Item(0).Children.Item(2).Click
    doc.querySelector("input#pt9\:id1\:\:content").Value = "30/06/" & studyyear
    doc.querySelector("input#pt9\:id2\:\:content").Value = "30/06/" & studyyear + 1
    doc.querySelector("div#pt9\:b1").Click
    Application.Wait Now + #12:00:05 AM#
    
    'Set testVar = doc.querySelector("a#pt2\:resId1\:20\:cl1")
    Set doc = ie.document
    If Not doc.querySelector("table.x14q") Is Nothing Then
        doc.querySelector("table.x14q").Children.Item(1).Children.Item(0).Children.Item(1).Children.Item(0).Click
    End If
    Application.Wait Now + #12:00:05 AM#
    Set doc = ie.document
    doc.querySelector("div#pt2\:tab2\:\:ti").Click
    Application.Wait Now + #12:00:02 AM#
    Set doc = ie.document
    'Index Column
    Cells(2, 1) = "Net Sales"
    Cells(3, 1) = "COGS"
    Cells(4, 1) = "Selling expense"
    Cells(5, 1) = "M&A Expense"
    Cells(6, 1) = "MOTC"
    Cells(7, 1) = "ROS"
    '2021
    Set testVar = doc.querySelector("table.x15f tbody")
    'Cells(1, 2) = doc.querySelector("table.x15f tbody").Children.Item(2).Children.Item(3).innerText
    NSStr = doc.querySelector("table.x15f tbody").Children.Item(2).Children.Item(3).innerText
    NSStr = Replace(NSStr, ",", "")
    NS = CLngLng(NSStr)
    Cells(2, 2) = Format(NS, "#,###")
    COGSStr = doc.querySelector("table.x15f tbody").Children.Item(3).Children.Item(3).innerText
    COGSStr = Replace(COGSStr, ",", "")
    COGS = CLngLng(COGSStr)
    Cells(3, 2) = Format(COGS, "#,###")
    SEStr = doc.querySelector("table.x15f tbody").Children.Item(9).Children.Item(3).innerText
    SEStr = Replace(SEStr, ",", "")
    SE = CLngLng(SEStr)
    Cells(4, 2) = Format(SE, "#,###")
    GAEStr = doc.querySelector("table.x15f tbody").Children.Item(10).Children.Item(3).innerText
    GAEStr = Replace(GAEStr, ",", "")
    GAE = CLngLng(GAEStr)
    Cells(5, 2) = Format(GAE, "#,###")
    Cells(6, 2) = Format(MOTC(NS, COGS, SE, GAE), "#.##%")
    Cells(7, 2) = Format(ROS(NS, COGS, SE, GAE), "#.##%")
    Cells(8, 2) = "=(" + NS + "-" + COGS + "-" + SE + "-" + GAE + ")/(" + COGS + "+" + SE + "+" + GAE + ")"
    
    ie.Quit
ErrorHandler:
    ie.Quit
    Exit Sub
End Sub

Function MOTC(NS, COGS, SE, GAE)
    Dim GProfit As LongLong
    Dim EBIT As LongLong
    
    GProfit = NS - COGS
    EBIT = GProfit - SE - GAE
    If (NS - EBIT) = 0 Then
        MOTC = 0
    Else
        MOTC = EBIT / (NS - EBIT)
    End If
End Function

Function ROS(NS, COGS, SE, GAE)
    Dim GProfit As LongLong
    Dim EBIT As LongLong
    
    GProfit = NS - COGS
    EBIT = GProfit - SE - GAE
    If NS = 0 Then
        ROS = 0
    Else
        ROS = EBIT / NS
    End If
End Function

